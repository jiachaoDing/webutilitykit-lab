name = "webutilitykit-lab"
main = "src/index.ts"
compatibility_date = "2026-01-02"

# Workers Static Assets: 将 public/ 作为静态资源目录，并通过 env.ASSETS.fetch() 交给边缘分发
assets = { directory = "./public", binding = "ASSETS" }

[vars]
APP_NAME = "webutilitykit-lab"
APP_VERSION = "0.1.0"
#
# - 采样频率：每分钟一次，每次爬取 5 把武器（5 把/分钟）
# - 采样组合：奇数分钟 5 Hot / 偶数分钟 5 Cold
# - 存储架构：状态与名单存 KV，价格数据暂存 KV 缓冲区，每 10 分钟批量同步至 D1
# - 时间对齐：1 分钟（确保高分辨率趋势图）
# - 游标备份：每分钟更新 KV 进度，每小时同步备份一次到 D1
HOT_BATCH_SIZE_ODD = "5"   # 奇数分钟：热门武器数量
HOT_BATCH_SIZE_EVEN = "0"  # 偶数分钟：热门武器数量
COLD_BATCH_SIZE = "5"      # 偶数分钟：冷门武器数量

[[d1_databases]]
binding = "DB"
database_name = "webutilitykit-lab-db"
database_id = "d2f50fd6-5410-4913-b7af-19a767e9ce25"

[triggers]
crons = ["* * * * *", "0 3 * * *"]

[placement]
mode = "smart"

[[routes]]
pattern = "lab.webutilitykit.com"
zone_name = "webutilitykit.com"
custom_domain = true

[[kv_namespaces]]
binding = "KV"
id = "4044f8ce15584d4cbdb6c3117eb458c3"

[durable_objects]
bindings = [
  { name = "RIVEN_COORDINATOR", class_name = "RivenCoordinatorDO" }
]

[[migrations]]
tag = "v1-riven-do"
new_classes = ["RivenCoordinatorDO"]


[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true